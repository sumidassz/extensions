local dungeonWorld = workspace.Worlds['Dungeon']
local dungeonEnemies = dungeonWorld.Enemies
local dungeonMap = dungeonWorld.Map.Model
local dungeonRooms = dungeonMap:GetChildren()
if #dungeonEnemies:GetChildren() == 0 then
    for _, room in ipairs(dungeonRooms) do
        if room:FindFirstChild('ConfirmPart') and room.ConfirmPart:FindFirstChild('ProximityPrompt') then
            game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = room.ConfirmPart.CFrame*CFrame.new(0,2,0)
            wait()
            fireproximityprompt(room.ConfirmPart.ProximityPrompt)
        end
        for key, roomItem in ipairs(room:GetDescendants()) do
            if roomItem.Name == 'DungeonRoomDoorRemotePrompt' and roomItem:IsA('ProximityPrompt') then
                game.Players.LocalPlayer.Character:PivotTo(roomItem.Parent:GetPivot())
                fireproximityprompt(roomItem)
            end
        end
    end
else
    for _, enemy in ipairs(dungeonEnemies:GetChildren()) do
        game.Players.LocalPlayer.Character:PivotTo(enemy:GetPivot())
        if enemy:FindFirstChild('HumanoidRootPart') and enemy:FindFirstChild('Health') and enemy.Health.Value > 0 then
            if enemy:FindFirstChild('Attackers') then
                if teamForChests ~= "None" and teamForDmg ~= "None" then
                    if enemy.Name == 'Chest' then
                        for teamName, teamButton in pairs(playerTeams) do
                            if teamName == teamForChests then
                                for i, button in pairs(getconnections(teamButton.Activated)) do
                                    if i == 1 then
                                        button:Fire()
                                    end
                                end
                            end
                        end
                    else
                        for teamName, teamButton in pairs(playerTeams) do
                            if teamName == teamForDmg then
                                for i, button in pairs(getconnections(teamButton.Activated)) do
                                    if i == 1 then
                                        button:Fire()
                                    end
                                end
                            end
                        end
                    end
                    game.ReplicatedStorage.Bindable.SendPet:Fire(enemy, true)
                else
                    game.ReplicatedStorage.Bindable.SendPet:Fire(enemy, true)
                end
            end
            wait()
        end
    end
end

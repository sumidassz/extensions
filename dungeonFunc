if game.Players.LocalPlayer.World.Value ~= "Dungeon" then return end
if workspace.Camera.CameraType ~= Enum.CameraType.Attach then workspace.Camera.CameraType = Enum.CameraType.Attach end
local function getNearestMob(ignoreTable, world, exclusiveMob)
    local dist, thing = math.huge
    for i, v in next, workspace.Worlds[tostring(world)].Enemies:GetChildren() do
        if v.PrimaryPart ~= nil then
            if exclusiveMob == "" and v:FindFirstChild("Health") and tonumber(v.Health.Value) > 0 and v:FindFirstChild("DisplayName") and not table.find(ignoreTable, v.DisplayName.Value) then
                local mag = (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - v:GetPivot().Position).magnitude
                if mag < dist then
                    dist = mag
                    thing = v
                end
            end
        end
    end
    return thing
end
local function sendPets(mob)
    for _, pets in pairs(game:GetService("Workspace").Pets:GetChildren()) do
        if pets:FindFirstChild("Data") and pets.Data:FindFirstChild("Owner") and pets.Data:FindFirstChild("Attacking") and pets.Data.Owner.Value == game.Players.LocalPlayer and not pets.Data.Attacking.Value then
            game.ReplicatedStorage.Bindable.SendPet:Fire(mob, false);
        end
    end
end
local function autoFarmEverythingFunc(ignoreChest, tp)
    if game.Players.LocalPlayer.Character ~= nil and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        if ignoreChest and getNearestMob({"Chest"}, game.Players.LocalPlayer.World.Value, "") ~= nil then
            sendPets(getNearestMob({"Chest"}, game.Players.LocalPlayer.World.Value, ""))
            if tp then game.Players.LocalPlayer.Character:PivotTo(getNearestMob({"Chest"}, game.Players.LocalPlayer.World.Value, ""):GetPivot()) end
        elseif not ignoreChest and getNearestMob({""}, game.Players.LocalPlayer.World.Value, "") ~= nil then
            sendPets(getNearestMob({""}, game.Players.LocalPlayer.World.Value, ""))
            if tp then game.Players.LocalPlayer.Character:PivotTo(getNearestMob({""}, game.Players.LocalPlayer.World.Value, ""):GetPivot()) end
        end
    end
end
for _, enemy in pairs(workspace.Worlds.Dungeon.Enemies:GetChildren()) do
    if enemy.Name == "Chest" then
        autoFarmEverythingFunc(false, true)
    elseif enemy.Name ~= "Chest" then
        autoFarmEverythingFunc(true, true)
    end
end
for _, pp in pairs(workspace.Worlds.Dungeon.Map.Model:GetDescendants()) do
    if pp:IsA("ProximityPrompt") and pp.Parent:IsA("Part") then
        if (game.Players.LocalPlayer.Character.HumanoidRootPart.Position-pp.Parent.Position).magnitude > 15 then
            if pp.Parent.Color ~= Color3.fromRGB(206, 46, 31) then
                game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = pp.Parent.CFrame*CFrame.new(0,2,0)
            elseif pp.Parent.Color == Color3.fromRGB(206, 46, 31) and game.Players.LocalPlayer.PlayerGui.MainGui.DungeonMinimap.Key.Image == "rbxassetid://10021306822" then
                game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = pp.Parent.CFrame*CFrame.new(0,2,0)
            end
        end
        fireproximityprompt(pp, 1)
    end
end
